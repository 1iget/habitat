{{#watch}}
{{#groups}}
defaults {{service-name}}-{{group-name}}
{{#tcp-enable}}
  mode tcp
  timeout connect {{tcp.connect}}
  timeout server {{tcp.server}}
  timeout client {{tcp.client}}
{{/tcp-enable}}

frontend ft_{{service-name}}-{{group-name}}
 bind {{bind}} name {{service-name}}-{{group-name}}
 default_backend bk_{{service-name}}-{{group-name}}

backend bk_{{service-name}}-{{group-name}}
 option httpchk GET /health HTTP/1.1\r\nHost:\ bldr
 http-check expect rstring topology-leader\ =\ true

 {{#config.topology.census}}
 server {{hostname}} {{ip}}:{{port}} check port 9631 inter 1s
 {{/config.topology.census}}
{{/groups}}
{{/watch}}
