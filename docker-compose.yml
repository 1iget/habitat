bldr:
  image: chef/bldr
  environment:
    DOCKER_CERT_PATH: "/docker-certs"
    DOCKER_TLS_VERIFY: 1
  volumes:
    - .:/src
    - "~/.boot2docker/certs/boot2docker-vm:/docker-certs"
  volumes_from:
    - "bldr-cargo-cache"
    - "bldr-keys-cache"
    - "bldr-installed-cache"
  links:
    - repo
    - etcd

repo:
  image: nginx
  ports:
    - "8080:80"
  volumes_from:
    - "bldr-pkg-cache"
    - "bldr-keys-cache"
  command: bash -c 'rm -rf /usr/share/nginx/html; ln -s /opt/bldr/cache /usr/share/nginx/html; exec nginx -g "daemon off;"'

package:
  image: chef/bldr
  privileged: true
  environment:
    DOCKER_CERT_PATH: "/docker-certs"
    DOCKER_TLS_VERIFY: 1
  volumes:
    - .:/src
    - "~/.boot2docker/certs/boot2docker-vm:/docker-certs"
  volumes_from:
    - "bldr-cargo-cache"
    - "bldr-pkg-cache"
    - "bldr-keys-cache"
    - "bldr-src-cache"
    - "bldr-installed-cache"
  links:
    - etcd

base:
  image: bldr
  links:
    - repo
    - etcd

etcd:
  image: quay.io/coreos/etcd:latest
  ports:
    - "4001:4001"
    - "7001:7001"
  command: "-cors='*' -vv"
