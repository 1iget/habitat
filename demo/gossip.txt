Four terminals
pkg-shell each
ifconfig in each

Tab two
Four terminals
docker exec in each, mapping to the other tab
ifconfig in each
jq installed in each

even network 4 and 6
odd network 5 and 7

Start 4
env RUST_LOG=warn ./target/debug/bldr start chef/redis --gossip-permanent

Start 5
env RUST_LOG=warn ./target/debug/bldr start chef/redis --gossip-permanent --gossip-peer 172.17.0.4

Start 6
env RUST_LOG=warn ./target/debug/bldr start chef/redis --gossip-peer 172.17.0.4 --gossip-permanent

Start 7
env RUST_LOG=warn ./target/debug/bldr start chef/redis --gossip-peer 172.17.0.5 --gossip-permanent


Show that they both saw each other as alive

Show the gossip endpoint of the sidecar

curl http://localhost:9631/gossip | jq .

Show how we will show status

curl http://localhost:9631/gossip | jq '.member_list.members | map({ip: .ip, health: .health})'

Partition 4 from 5
On 4
iptables -A INPUT -s 172.17.0.5 -j DROP
On 5
iptables -A INPUT -s 172.17.0.4 -j DROP

Show that.. they stay alive, because they can find a route to each other
through 6 and 7

Heal the partition
On 4
iptables -D INPUT -s 172.17.0.5 -j DROP
On 5
iptables -D INPUT -s 172.17.0.4 -j DROP



Partition 4 and 6 from 5 and 7

On 4 and 6
iptables -A INPUT -s 172.17.0.5 -j DROP
iptables -A INPUT -s 172.17.0.7 -j DROP

On 5 and 7
iptables -A INPUT -s 172.17.0.4 -j DROP
iptables -A INPUT -s 172.17.0.6 -j DROP

Show the status on both sides

curl http://localhost:9631/gossip | jq '.member_list.members | map({ip: .ip, health: .health})'

Describe the alzheimers problem

Heal the partition

On 4 + 6
iptables -D INPUT -s 172.17.0.5 -j DROP
iptables -D INPUT -s 172.17.0.7 -j DROP

On 5 + 7
iptables -D INPUT -s 172.17.0.4 -j DROP
iptables -D INPUT -s 172.17.0.6 -j DROP

